Based on work done by John Barrett <jbarrett@box100.com>
